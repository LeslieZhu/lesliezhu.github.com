
        <!DOCTYPE HTML>
        <html>
        <head>
        <meta charset="utf-8">
        
        <script>
        var CONFIG = {
        root: '/',
        localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"preload":true},
        path: 'search.json',
        };
        </script>
        
        <title>Linux如何设置用户长时间不操作就自动登出?</title>
        <meta name="author" content="吴羽舒">
        <meta name="email" content="minyilife@use-wechat.com">
        <meta name="description" content="Use OrgNote.">
        <meta property="og:site_name" content="MinYiLife"/>
        <meta name="Keywords" content="OrgNote,Emacs,org-mode,blog,python,geek,markdown,c++">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta property="og:image" content="undefined"/>

        <link href="/favicon.ico" rel="icon">
        
        <link rel="stylesheet" href="/theme/freemind/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/font-awesome.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/highlight.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/default-highlight.css" media="screen" type="text/css">
        <script type="text/javascript" src="/theme/freemind/js/jquery-2.0.3.min.js"></script>
        <script type="text/javascript" src="/theme/freemind/js/local-search.js?v=7.4.1"></script>
        <style></style>
        </head>
        
        <body>  
        <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        
        <div class="container">
        
        <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        </button>
    
        <a class="navbar-brand" href="/index.html">MinYiLife</a>
        
        <div class="collapse navbar-collapse nav-menu">
        
        <ul class="nav navbar-nav">
        <li><a href="http://www.lesliezhu.com/links.html" title="MinYi"><i class="fa fa-sitemap"></i>MinYi</a></li><li><a href="http://www.lesliezhu.com/archive.html" title="归档"><i class="fa fa-archive"></i>归档</a></li><li><a href="http://www.lesliezhu.com/tags.html" title="标签"><i class="fa fa-tags"></i>标签</a></li><li><a href="http://www.lesliezhu.com/about.html" title="说明"><i class="fa fa-user"></i>说明</a></li><li><a href="http://www.lesliezhu.com/rss.xml" title="订阅" target="_blank"><i class="fa fa-rss"></i>订阅</a></li><li>
                <a role="button" class="popup-trigger">
                <i class="fa fa-search fa-fw"></i>搜索
                </a>
                </li>
                
        <div class="site-search">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
            <div class="search-input-container">
              <input autocomplete="off" autocorrect="off" autocapitalize="none"
                     placeholder="Searching..." spellcheck="false"
                     type="text" id="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
          </div>
          <div id="search-result"></div>
        </div>
        <div class="search-pop-overlay"></div>
        
        </ul>
        
        </div> <!-- navbar -->
        </div> <!-- container -->
        </nav>
        
        <div class="clearfix"></div>
        <div class="container">
        <div class="content">
        
        <div class="page-header">                   <!-- page-header begin -->
        <h1>Linux如何设置用户长时间不操作就自动登出?</h1>
        </div>                                      <!-- page-header end -->
        
        <div class="row page">                      <!-- row-page begin -->
        <div class="col-md-9">                            <!-- col-md-9/12 begin -->
        <div class="mypage">                        <!-- mypage begin -->
        
        <div class="slogan">                        <!-- slogan begin -->
        <i class="fa fa-heart"></i>
        标签: <a href="http://www.lesliezhu.com/tags/Linux操作与管理.html"><i class="Linux操作与管理"></i>Linux操作与管理</a><span class='date'>文|<a href='http://www.lesliezhu.com/about.html'><i class='http://www.lesliezhu.com/about.html'></i>吴羽舒</a></span>
        </div>                                     <!-- slogan end -->
        <div id='content'>
<h2>引言</h2>
<p>当我们登录Linux系统后，如果长时间不操作，比如忘记关闭终端窗口了，怎么做到用户自动退出登录呢？</p>
<div class="highlight"><pre><span></span>$ ls -l /etc/profile
-rw-r--r-- <span class="m">1</span> root root <span class="m">1819</span> Apr  <span class="m">1</span>  <span class="m">2020</span> /etc/profile
</pre></div>
<p>这个文件是系统环境变量的配置文件，并且只有root有修改权限；如果能够在这个文件里面做一些设置，那么每个用户登录后都会加载里面的配置。</p>
<h2>/etc/profile</h2>
<div class="highlight"><pre><span></span><span class="c1"># /etc/profile</span>

<span class="c1"># System wide environment and startup programs, for login setup</span>
<span class="c1"># Functions and aliases go in /etc/bashrc</span>

<span class="c1"># It's NOT a good idea to change this file unless you know what you</span>
<span class="c1"># are doing. It's much better to create a custom.sh shell script in</span>
<span class="c1"># /etc/profile.d/ to make custom changes to your environment, as this</span>
<span class="c1"># will prevent the need for merging in future updates.</span>
</pre></div>
<p>这个文件不建议直接修改，而是创建自己的配置文件:</p>
<div class="highlight"><pre><span></span>$ ls -1 /etc/profile.d/*
/etc/profile.d/colorgrep.csh
/etc/profile.d/colorgrep.sh
/etc/profile.d/colorls.csh
/etc/profile.d/colorls.sh
/etc/profile.d/csh.local
/etc/profile.d/less.csh
/etc/profile.d/less.sh
/etc/profile.d/sh.local
/etc/profile.d/vim.csh
/etc/profile.d/vim.sh
/etc/profile.d/which2.csh
/etc/profile.d/which2.sh
</pre></div>
<p>这些都是系统默认自带的定制环境变量，我们看下<code>vim.sh</code>里面内容:</p>
<div class="highlight"><pre><span></span><span class="c1"># cat /etc/profile.d/vim.sh</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$BASH_VERSION</span><span class="s2">"</span> -o -n <span class="s2">"</span><span class="nv">$KSH_VERSION</span><span class="s2">"</span> -o -n <span class="s2">"</span><span class="nv">$ZSH_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="o">[</span> -x /usr/bin/id <span class="o">]</span> <span class="o">||</span> <span class="k">return</span>
  <span class="nv">ID</span><span class="o">=</span><span class="sb">`</span>/usr/bin/id -u<span class="sb">`</span>
  <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$ID</span><span class="s2">"</span> -a <span class="s2">"</span><span class="nv">$ID</span><span class="s2">"</span> -le <span class="m">200</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>
  <span class="c1"># for bash and zsh, only if no alias is already set</span>
  <span class="nb">alias</span> vi &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">||</span> <span class="nb">alias</span> <span class="nv">vi</span><span class="o">=</span>vim
<span class="k">fi</span>
</pre></div>
<h2>/etc/profile.d/timeout.sh</h2>
<blockquote>
<p>TMOUT</p>
<p>If set to a value greater than zero, TMOUT is treated as the default  timeout  for  the  read  builtin.   The
 select  command terminates if input does not arrive after TMOUT seconds when input is coming from a terminal.
 In an interactive shell, the value is interpreted as the number of seconds to wait for  input  after  issuing
 the primary prompt.  Bash terminates after waiting for that number of seconds if input does not arrive.</p>
</blockquote>
<p>以<code>root</code>用户新建<code>/etc/profile.d/timeout.sh</code>文件，用于定义变量<code>TMOUT</code>大于0，用户超时不操作自动退出登录:</p>
<div class="highlight"><pre><span></span><span class="c1"># cat /etc/profile.d/timeout.sh</span>

<span class="nb">readonly</span> <span class="nv">TMOUT</span><span class="o">=</span><span class="m">600</span> <span class="c1"># 单位是秒(s)</span>
<span class="nb">export</span> TMOUT
</pre></div>
<p>变量<code>TMOUT</code>的作用是在<code>Shell</code>超过一定时间无操作后自动退出登录。</p>
<div class="highlight"><pre><span></span>$ <span class="nb">unset</span> TMOUT
bash: unset: TMOUT: cannot unset: <span class="nb">readonly</span> variable

$ <span class="nv">TMOUT</span><span class="o">=</span><span class="m">1000</span>
bash: TMOUT: <span class="nb">readonly</span> variable
</pre></div>
<p>而<code>readonly</code>是不允许修改这个值，除非<code>root</code>用户修改配置文件并重新登录才可以修改生效。</p>
<h2>总结</h2>
<p>这样设置后，所有用户超过600秒不操作，登录的终端就自动退出登录了，在一定程度上增加了Linux系统的安全性。</p>
</div>
        <hr>
        <div id="post-copyright">
        <ul class="post-copyright">
        <li class="post-copyright-author">
        <strong>本文作者：</strong>「
        <a href="http://www.lesliezhu.com/about.html" title="吴羽舒">吴羽舒</a> 」创作于2022-11-20 Sun，共280字
        </li>
        <li><strong>微信搜索：</strong> <span>「 <a href='http://www.lesliezhu.com/images/weixin.jpg'>MinYiLife</a> 」</span>, 关注公众号!<li>
        <li class="post-copyright-link">
        <strong>本文链接：</strong>
        <a href="http://www.lesliezhu.com/2022/11/20/TMOUT_env_variable_in_liunux.html" title="Linux如何设置用户长时间不操作就自动登出?">http://www.lesliezhu.com/2022/11/20/TMOUT_env_variable_in_liunux.html</a>
        </li>
        <li class="post-copyright-license">
        <strong>版权声明：</strong>
        原创文章，如需转载请注明文章作者和出处。谢谢！
        </li>
        </ul>
        </div>
        
            <div>
            <center>
            <div class="pagination">
            <ul class="pagination">
            <li class="prev"><a href="http://www.lesliezhu.com/2022/11/21/PAM_in_linux.html" class=alignright prev"><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
            <li><a href="http://www.lesliezhu.com/archive.html" target="_blank"><i class="fa fa-archive"></i>Archive</a></li>
            <li class="next"><a href="http://www.lesliezhu.com/2022/11/17/git_subtree_and_submodule.html" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a></li>
            </ul>
            </div>
            </center>
            </div>
            
            <div class="post-reward">
            <input type="checkbox" name="reward" id="reward" hidden />
            <label id="reward-button" class="reward-button" for="reward">赞赏支持</label>
            <div class="qr-code">
            
                <label id="qr-code-image-w" class="qr-code-image" for="reward" hidden>
                <img class="image" src="http://www.lesliezhu.com//images/wechatpay.jpg">
                <span>微信打赏</span>
                </label>
                
                <label id="qr-code-image-p" class="qr-code-image" for="reward" hidden>
                <img class="image" src="http://www.lesliezhu.com//images/weixin.jpg">
                <span>微信公众号</span>
                </label>
                
            </div>
            </div>
            
            
            <script src="https://utteranc.es/client.js"
            repo="LeslieZhu/lesliezhu.github.com"
            issue-term="title"
            theme="github-light"
            crossorigin="anonymous"
            async>
            </script>
            </div> <!-- my-page --></div> <!-- col-md -->
        <div class="col-md-3">
        <div id="sidebar">
        
        <div class="widget">
        <h4>微信公众号</h4>
        <ul class="entry list-unstyled">
        <li><img src='/images/weixin.jpg'></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>最新文章</h4>
        <ul class="entry list-unstyled">
        <li><a href="http://www.lesliezhu.com/2023/01/15/Freud_Three_Essays_On_The_Theory_Of_Sexuality.html"><i class="fa fa-file-o"></i>弗洛伊德与《性学三论》</a></li><li><a href="http://www.lesliezhu.com/2022/12/17/llvm_1.html"><i class="fa fa-file-o"></i>LLVM框架(1):开篇</a></li><li><a href="http://www.lesliezhu.com/2023/01/07/a_special_call_name_of_hakka.html"><i class="fa fa-file-o"></i>客家人的一种少见“伯-叔”类关系称呼</a></li><li><a href="http://www.lesliezhu.com/2023/01/06/learn_japanese_1.html"><i class="fa fa-file-o"></i>关于学日语这件事</a></li><li><a href="http://www.lesliezhu.com/2022/12/28/dockerfile_for_ledge.html"><i class="fa fa-file-o"></i>使用Dockerfile和CMake编译LLVM程序</a></li><li><a href="http://www.lesliezhu.com/2023/01/02/gnu_readline_in_repl.html"><i class="fa fa-file-o"></i>用readline库改进REPL交互体验</a></li>
        </ul>   
        </div> 
        
        <div class="widget">
        <h4>标签云</h4>
        <ul class="tag_box inline list-unstyled">
        <li><a href="http://www.lesliezhu.com/tags/C++学习与实践.html">C++学习与实践<span>27</span></a></li><li><a href="http://www.lesliezhu.com/tags/解释器与编译器.html">解释器与编译器<span>14</span></a></li><li><a href="http://www.lesliezhu.com/tags/读书札记.html">读书札记<span>7</span></a></li><li><a href="http://www.lesliezhu.com/tags/Linux操作与管理.html">Linux操作与管理<span>7</span></a></li><li><a href="http://www.lesliezhu.com/tags/南野集.html">南野集<span>3</span></a></li><li><a href="http://www.lesliezhu.com/tags/日语学习.html">日语学习<span>1</span></a></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>时间机器</h4>
        <ul class="tag_box inline list-unstyled">
        <li><a href="http://www.lesliezhu.com/tags/202301.html">202301<span>6</span></a></li><li><a href="http://www.lesliezhu.com/tags/202212.html">202212<span>10</span></a></li><li><a href="http://www.lesliezhu.com/tags/202211.html">202211<span>13</span></a></li><li><a href="http://www.lesliezhu.com/tags/202210.html">202210<span>9</span></a></li><li><a href="http://www.lesliezhu.com/tags/202206.html">202206<span>3</span></a></li><li><a href="http://www.lesliezhu.com/tags/202205.html">202205<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/202005.html">202005<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/201910.html">201910<span>1</span></a></li><li><a href="http://www.lesliezhu.com/archive.html">All<span>44</span></a></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>作品链接</h4>
        <ul class="entry list-unstyled">
        
            <li><a href="https://github.com/LeslieZhu" title="GitHub主页" target="_blank"><i class="fa fa-home"></i>GitHub主页</a></li>
            
            <li><a href="https://pypi.org/user/LeslieZhu/" title="PyPI主页" target="_blank"><i class="fa fa-code"></i>PyPI主页</a></li>
            
            <li><a href="http://lesliezhu.com" title="MinYiLife博客" target="_blank"><i class="fa fa-book"></i>MinYiLife博客</a></li>
            
            <li><a href="https://github.com/LeslieZhu/OrgNote" title="OrgNote:为自己定制的博客工具" target="_blank"><i class="fa fa-code-fork"></i>OrgNote:为自己定制的博客工具</a></li>
            
            <li><a href="https://github.com/ledge-lang" title="Ledge: 正在开发的一个编程语言" target="_blank"><i class="fa fa-code-fork"></i>Ledge: 正在开发的一个编程语言</a></li>
            
        </ul>
        </div>
        
        </div> <!-- sidebar -->
        </div> <!-- col-md-3 -->
        
        </div> <!-- row-fluid -->
        </div>
        </div>
        
        <div class="container-narrow">
        <footer>
        <p>&copy; 2014-2023 吴羽舒
        with help from <a href="https://github.com/LeslieZhu/OrgNote" target="_blank">OrgNote</a>. Theme by <a href="https://github.com/LeslieZhu/orgnote-theme-freemind">orgnote-theme-freemind</a>.  Published with GitHub Pages. 
        </p> </footer>
        </div> <!-- container-narrow -->
        
        <a id="gotop" href="#">   
        <span>▲</span> 
        </a>
        
        

        <script type="text/javascript">
        
        <!-- donate script -->
        var reward = document.getElementById('reward');
        if(reward){
            reward.onclick = function() {
              $('#reward-button').addClass('hidden');
              $('#qr-code-image-w').show();
              $('#qr-code-image-a').show();
              $('#qr-code-image-p').show();
            }
        }
        <!-- /donate script -->

        
        function showul(name){
            var uls = document.getElementById(name);
            if(uls.style.display == "none"){
               uls.style.display = "block";
            } else {
               uls.style.display = "none";
            } 
        }
        </script>
        

        </body>
        </html>
        
