
        <!DOCTYPE HTML>
        <html>
        <head>
        <meta charset="utf-8">
        
        <script>
        var CONFIG = {
        root: '/',
        localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"preload":true},
        path: 'search.json',
        };
        </script>
        
        <title>CStdString:一个跨平台的字符串类实现</title>
        <meta name="author" content="吴羽舒">
        <meta name="email" content="minyilife@use-wechat.com">
        <meta name="description" content="Use OrgNote.">
        <meta property="og:site_name" content="MinYiLife"/>
        <meta name="Keywords" content="OrgNote,Emacs,org-mode,blog,python,geek,markdown,c++">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta property="og:image" content="undefined"/>

        <link href="/favicon.ico" rel="icon">
        
        <link rel="stylesheet" href="/theme/freemind/css/bootstrap.min.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/font-awesome.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/style.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/highlight.css" media="screen" type="text/css">
        <link rel="stylesheet" href="/theme/freemind/css/default-highlight.css" media="screen" type="text/css">
        <script type="text/javascript" src="/theme/freemind/js/jquery-2.0.3.min.js"></script>
        <script type="text/javascript" src="/theme/freemind/js/local-search.js?v=7.4.1"></script>
        <style></style>
        </head>
        
        <body>  
        <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        
        <div class="container">
        
        <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        </button>
    
        <a class="navbar-brand" href="/index.html">MinYiLife</a>
        
        <div class="collapse navbar-collapse nav-menu">
        
        <ul class="nav navbar-nav">
        <li><a href="http://www.lesliezhu.com/links.html" title="MinYi"><i class="fa fa-sitemap"></i>MinYi</a></li><li><a href="http://www.lesliezhu.com/archive.html" title="归档"><i class="fa fa-archive"></i>归档</a></li><li><a href="http://www.lesliezhu.com/tags.html" title="标签"><i class="fa fa-tags"></i>标签</a></li><li><a href="http://www.lesliezhu.com/about.html" title="说明"><i class="fa fa-user"></i>说明</a></li><li><a href="http://www.lesliezhu.com/rss.xml" title="订阅" target="_blank"><i class="fa fa-rss"></i>订阅</a></li><li>
                <a role="button" class="popup-trigger">
                <i class="fa fa-search fa-fw"></i>搜索
                </a>
                </li>
                
        <div class="site-search">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
            <div class="search-input-container">
              <input autocomplete="off" autocorrect="off" autocapitalize="none"
                     placeholder="Searching..." spellcheck="false"
                     type="text" id="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
          </div>
          <div id="search-result"></div>
        </div>
        <div class="search-pop-overlay"></div>
        
        </ul>
        
        </div> <!-- navbar -->
        </div> <!-- container -->
        </nav>
        
        <div class="clearfix"></div>
        <div class="container">
        <div class="content">
        
        <div class="page-header">                   <!-- page-header begin -->
        <h1>CStdString:一个跨平台的字符串类实现</h1>
        </div>                                      <!-- page-header end -->
        
        <div class="row page">                      <!-- row-page begin -->
        <div class="col-md-9">                            <!-- col-md-9/12 begin -->
        <div class="mypage">                        <!-- mypage begin -->
        
        <div class="slogan">                        <!-- slogan begin -->
        <i class="fa fa-heart"></i>
        标签: <a href="http://www.lesliezhu.com/tags/C++学习与实践.html"><i class="C++学习与实践"></i>C++学习与实践</a><span class='date'>文|<a href='http://www.lesliezhu.com/about.html'><i class='http://www.lesliezhu.com/about.html'></i>吴羽舒</a></span>
        </div>                                     <!-- slogan end -->
        <div id='content'>
<h2>引言</h2>
<blockquote>
<p>A Drop-In replacement for CString that builds on the Standard C++ Library's basic_string template</p>
</blockquote>
<p>在C++标准库中有一个<code>std::string</code>字符串类实现，但它的功能简陋一些；而在VC++ MFC中有一个<code>CString</code>类，提供了丰富的字符串操作接口。</p>
<p><code>CStdString</code>是一个类似<code>CString</code>操作接口的、跨平台的字符串类实现，作者是<code>Joe O'Leary</code>，使用它只需要包含整个头文件<code>StdString.h</code>。</p>
<p>相关信息很少，找到下列链接:</p>
<ul>
<li>作者 <code>Joe O'Leary</code> 主页（已经无法打开）:<a href="http://www.joeo.net/">http://www.joeo.net/</a></li>
<li><code>StdString.h</code> 说明页面（已经无法打开）:<a href="http://home.earthlink.net/~jmoleary/stdstring.htm">http://home.earthlink.net/~jmoleary/stdstring.htm</a></li>
<li>别人整理的相关repo:<ul>
<li><a href="https://github.com/lunakid/CStdString">https://github.com/lunakid/CStdString</a></li>
<li><a href="https://github.com/xparq/CStdString">https://github.com/xparq/CStdString</a></li>
</ul>
</li>
<li>作者2011年写的文章 <a href="https://www.codeproject.com/Articles/1146/CString-clone-Using-Standard-C">CString-clone Using Standard C++</a></li>
</ul>
<h2>早期版本: StdString.h</h2>
<p><code>2011-12-05</code> 的版本（没找到更新版本）:</p>
<div class="highlight"><pre><span></span>//  FILE:  StdString.h
//  AUTHOR:	Joe O'Leary (with outside help noted in comments)
//
//		If you find any bugs in this code, please let me know:
//
//				jmoleary@earthlink.net
//				http://www.joeo.net/stdstring.htm (a bit outdated)
//
//      The latest version of this code should always be available at the
//      following link:
//
//              http://www.joeo.net/code/StdString.zip (Dec 6, 2003)
//
//
//  REMARKS:
//		This header file declares the CStdStr template.  This template derives
//		the Standard C++ Library basic_string&lt;&gt; template and add to it the
//		the following conveniences:
//			- The full MFC CString set of functions (including implicit cast)
//			- writing to/reading from COM IStream interfaces
//			- Functional objects for use in STL algorithms
//
//		From this template, we intstantiate two classes:  CStdStringA and
//		CStdStringW.  The name "CStdString" is just a #define of one of these,
//		based upone the UNICODE macro setting
//
//		This header also declares our own version of the MFC/ATL UNICODE-MBCS
//		conversion macros.  Our version looks exactly like the Microsoft's to
//		facilitate portability.
</pre></div>
<h2>作者文章(翻译)：CString-clone Using Standard C++</h2>
<h3>介绍</h3>
<p>从第一天使用C++标准库起，我就不喜欢它那个基于<code>basic_string&lt;&gt;</code>模板实现的字符串类，总觉得用起来不爽；相反，我却对MFC中的CString类情有独钟，它会检查NULL指针，可以隐式转换为<code>const TCHAR*</code>，以及丰富的操作函数等。但我没法再继续使用MFC，因为我需要移植性。</p>
<p>因此我决定创造一个两全其美的字符串实现，即CStdString。它是一个基于<code>basic_string&lt;TCHAR&gt;</code>模板实现的字符串类，然后在<code>basic_string</code>基础上添加了CString API接口；从而可以获得CString的易用性，又可以获得basic_string的兼容性。</p>
<p>一句话，CStdString可以直接替换掉CString。</p>
<h3>特性</h3>
<ul>
<li>可以直接替换CString</li>
<li>同时提供两个实例，基于<code>wchar_t</code>的CStdStringW和基于<code>char</code>的CStdStringA，而CStdString只是其中一个的别名</li>
<li>在所有函数中都可以安全的检查输入的NULL字符串指针</li>
<li>额外的构造函数和赋值操作函数使得可以自动在wchar_t和char字符串之间转换</li>
<li>隐式转换为<code>c_str()</code></li>
<li>支持多个平台，包括Windows、Unix和Linux；支持多个C++标准库实现，包括Dinkumware、GNU、CodeWarrior和STLPort</li>
<li>不依赖于任何basic_string模板类的实现细节</li>
<li>派生模板类没有在basic_string上添加任何元素和虚函数</li>
</ul>
<h3>CString兼容性</h3>
<p>我没有办法完全实现CString的所有API；如果一个函数既有CString版本，又有basic_string版本，但具体实现又不同，这个时候倾向于和basic_string保持一致。</p>
<ul>
<li>CStdString::operator[]返回的字符串是值传递，而CString是以引用传递形式</li>
<li>接收单个字符和字符数量的构造函数，它的顺序是<code>(cout,value)</code>，这和CString正好相反</li>
<li>还有两个CString的函数没有实现：LockBuffer和UnlockBuffer</li>
</ul>
<h2>关于性能的说明</h2>
<div class="highlight"><pre><span></span>"Performance" is a fairly encompassing term. Most of the performance differences will 
come down to the performance of std::string vs CString. That depends upon your 
particular implementation of basic_string, over which I have no control

For the performance of various CString-facade functions (e.g. format), well at this point 
I am long past comparing those or worrying about it. It is not going to make a difference 
in 99% of the cases. You would have to be doing some monster-level of string processing 
for it to matter.

If that sounds like a bit of a dismissal, I suppose it is. This class is mostly meant to 
help people transition over from CString to std::string with a minimum of code-rewrite. 
To help you get off of MFC&gt; The idea is that you can get your code running right away and 
then start refactoring any important string processing code to use basic_string properly, 
in the most efficient way you see fit. This class is not meant to be used alongside CString. 
But if it must, well you can then always use CString instead. This class coexist well with it.

-Joe
</pre></div>
<h2>别人的言论与评价</h2>
<p>在 <a href="https://stackoverflow.com/questions/5437675/mixing-objc-and-c-with-c-template-classes-in-more-than-one-source?r=SearchResults">mixing-objc-and-c-with-c-template-classes-in-more-than-one-source</a> 上获取到这些信息:</p>
<div class="highlight"><pre><span></span>Joe's CStdString is in fact a derived class from std::string.

Anyway, bad thing - good thing: CStdString has no own members. It's a straightforward 
wrapper for one/two byte instantiations of std::basic_string with the convenience of 
most features that MFC CString offers and a wide usability. I used it on Linux more 
than 10 years ago and on Win32 where I couldn't use MFC. Joe's work on it started 1998 
with help of ~50 people within 7 years of development. I think they've managed the 
poorly side effects being in the template.
</pre></div>
<h2>CStdString如何转换为char*</h2>
<p>C++中类型转换例子:</p>
<div class="highlight"><pre><span></span>CStdString key = "hello";
char * cKey = const_cast&lt;char *&gt;(key.c_str());
</pre></div>
<h2>CStdString常用操作接口</h2>
<ul>
<li>AppendFormat</li>
<li>CompareNoCase</li>
<li>Empty</li>
<li>Equals</li>
<li>Find</li>
<li>FindNoCase</li>
<li>FindNotInPair</li>
<li>Format</li>
<li>GetLength</li>
<li>MakeLower</li>
<li>MakeUpper</li>
<li>MakeReverse</li>
<li>Match</li>
<li>MatchNoCase</li>
<li>Replace</li>
<li>Trim</li>
<li>......</li>
</ul>
</div>
        <hr>
        <div id="post-copyright">
        <ul class="post-copyright">
        <li class="post-copyright-author">
        <strong>本文作者：</strong>「
        <a href="http://www.lesliezhu.com/about.html" title="吴羽舒">吴羽舒</a> 」创作于2023-03-02 Thu，共605字
        </li>
        <li><strong>微信搜索：</strong> <span>「 <a href='http://www.lesliezhu.com/images/weixin.jpg'>MinYiLife</a> 」</span>, 关注公众号!<li>
        <li class="post-copyright-link">
        <strong>本文链接：</strong>
        <a href="http://www.lesliezhu.com/2019/12/29/about_CStdString.html" title="CStdString:一个跨平台的字符串类实现">http://www.lesliezhu.com/2019/12/29/about_CStdString.html</a>
        </li>
        <li class="post-copyright-license">
        <strong>版权声明：</strong>
        原创文章，如需转载请注明文章作者和出处。谢谢！
        </li>
        </ul>
        </div>
        
            <div>
            <center>
            <div class="pagination">
            <ul class="pagination">
            <li class="prev"><a href="http://www.lesliezhu.com/2023/03/03/use_StableDiffusion_gen_photo.html" class=alignright prev"><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
            <li><a href="http://www.lesliezhu.com/archive.html" target="_blank"><i class="fa fa-archive"></i>归档</a></li>
            <li class="next"><a href="http://www.lesliezhu.com/2023/03/01/doxygen_work_with_cmake.html" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a></li>
            </ul>
            </div>
            </center>
            </div>
            
            <div class="post-reward">
            <input type="checkbox" name="reward" id="reward" hidden />
            <label id="reward-button" class="reward-button" for="reward">赞赏支持</label>
            <div class="qr-code">
            
                <label id="qr-code-image-w" class="qr-code-image" for="reward" hidden>
                <img class="image" src="http://www.lesliezhu.com//images/wechatpay.jpg">
                <span>微信打赏</span>
                </label>
                
                <label id="qr-code-image-p" class="qr-code-image" for="reward" hidden>
                <img class="image" src="http://www.lesliezhu.com//images/weixin.jpg">
                <span>微信公众号</span>
                </label>
                
            </div>
            </div>
            
            
            <script src="https://utteranc.es/client.js"
            repo="LeslieZhu/lesliezhu.github.com"
            issue-term="title"
            theme="github-light"
            crossorigin="anonymous"
            async>
            </script>
            </div> <!-- my-page --></div> <!-- col-md -->
        <div class="col-md-3">
        <div id="sidebar">
        
        <div class="widget">
        <h4>微信公众号</h4>
        <ul class="entry list-unstyled">
        <li><img src='/images/weixin.jpg'></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>最新文章</h4>
        <ul class="entry list-unstyled">
        <li><a href="http://www.lesliezhu.com/2023/05/31/hu_bian_de_mo_chou_nv.html"><i class="fa fa-file-o"></i>湖边的莫愁女</a></li><li><a href="http://www.lesliezhu.com/2023/04/13/yin_keng.html"><i class="fa fa-file-o"></i>南北朝人物之阴铿</a></li><li><a href="http://www.lesliezhu.com/2023/03/23/learn_japanese_4.html"><i class="fa fa-file-o"></i>日语入门阶段例句整理</a></li><li><a href="http://www.lesliezhu.com/2023/03/15/faceswap_1.html"><i class="fa fa-file-o"></i>FaceSwap进行视频AI换脸</a></li><li><a href="http://www.lesliezhu.com/2023/03/14/use_StableDiffusion_gen_photo_with_gpu_on_windows.html"><i class="fa fa-file-o"></i>Windows使用Stable Diffusion进行AI画图(GPU)</a></li><li><a href="http://www.lesliezhu.com/2023/03/03/use_StableDiffusion_gen_photo.html"><i class="fa fa-file-o"></i>Mac使用Stable Diffusion进行AI画图(CPU)</a></li>
        </ul>   
        </div> 
        
        <div class="widget">
        <h4>标签云</h4>
        <ul class="tag_box inline list-unstyled">
        <li><a href="http://www.lesliezhu.com/tags/C++学习与实践.html">C++学习与实践<span>32</span></a></li><li><a href="http://www.lesliezhu.com/tags/解释器与编译器.html">解释器与编译器<span>14</span></a></li><li><a href="http://www.lesliezhu.com/tags/Linux操作与管理.html">Linux操作与管理<span>9</span></a></li><li><a href="http://www.lesliezhu.com/tags/随笔札记.html">随笔札记<span>8</span></a></li><li><a href="http://www.lesliezhu.com/tags/南野集.html">南野集<span>6</span></a></li><li><a href="http://www.lesliezhu.com/tags/大数据与人工智能.html">大数据与人工智能<span>5</span></a></li><li><a href="http://www.lesliezhu.com/tags/日语学习.html">日语学习<span>4</span></a></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>时间机器</h4>
        <ul class="tag_box inline list-unstyled">
        <li><a href="http://www.lesliezhu.com/tags/202305.html">202305<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/202304.html">202304<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/202303.html">202303<span>6</span></a></li><li><a href="http://www.lesliezhu.com/tags/202302.html">202302<span>4</span></a></li><li><a href="http://www.lesliezhu.com/tags/202301.html">202301<span>11</span></a></li><li><a href="http://www.lesliezhu.com/tags/202212.html">202212<span>10</span></a></li><li><a href="http://www.lesliezhu.com/tags/202211.html">202211<span>13</span></a></li><li><a href="http://www.lesliezhu.com/tags/202210.html">202210<span>9</span></a></li><li><a href="http://www.lesliezhu.com/tags/202206.html">202206<span>3</span></a></li><li><a href="http://www.lesliezhu.com/tags/202205.html">202205<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/202005.html">202005<span>1</span></a></li><li><a href="http://www.lesliezhu.com/tags/201910.html">201910<span>1</span></a></li><li><a href="http://www.lesliezhu.com/archive.html">All<span>61</span></a></li>
        </ul>
        </div>
        
        <div class="widget">
        <h4>作品链接</h4>
        <ul class="entry list-unstyled">
        
            <li><a href="https://github.com/LeslieZhu" title="GitHub主页" target="_blank"><i class="fa fa-home"></i>GitHub主页</a></li>
            
            <li><a href="https://pypi.org/user/LeslieZhu/" title="PyPI主页" target="_blank"><i class="fa fa-code"></i>PyPI主页</a></li>
            
            <li><a href="http://lesliezhu.com" title="MinYiLife博客" target="_blank"><i class="fa fa-book"></i>MinYiLife博客</a></li>
            
            <li><a href="https://github.com/LeslieZhu/OrgNote" title="OrgNote:为自己定制的博客工具" target="_blank"><i class="fa fa-code-fork"></i>OrgNote:为自己定制的博客工具</a></li>
            
            <li><a href="https://github.com/ledge-lang" title="Ledge: 正在开发的一个编程语言" target="_blank"><i class="fa fa-code-fork"></i>Ledge: 正在开发的一个编程语言</a></li>
            
        </ul>
        </div>
        
        </div> <!-- sidebar -->
        </div> <!-- col-md-3 -->
        
        </div> <!-- row-fluid -->
        </div>
        </div>
        
        <div class="container-narrow">
        <footer>
        <p>&copy; 2014-2023 吴羽舒
        with help from <a href="https://github.com/LeslieZhu/OrgNote" target="_blank">OrgNote</a>. Theme by <a href="https://github.com/LeslieZhu/orgnote-theme-freemind">orgnote-theme-freemind</a>.  Published with GitHub Pages. 
        </p> </footer>
        </div> <!-- container-narrow -->
        
        <a id="gotop" href="#">   
        <span>▲</span> 
        </a>
        
        

        <script type="text/javascript">
        
        <!-- donate script -->
        var reward = document.getElementById('reward');
        if(reward){
            reward.onclick = function() {
              $('#reward-button').addClass('hidden');
              $('#qr-code-image-w').show();
              $('#qr-code-image-a').show();
              $('#qr-code-image-p').show();
            }
        }
        <!-- /donate script -->

        
        function showul(name){
            var uls = document.getElementById(name);
            if(uls.style.display == "none"){
               uls.style.display = "block";
            } else {
               uls.style.display = "none";
            } 
        }
        </script>
        

        </body>
        </html>
        
